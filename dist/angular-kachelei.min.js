/*! angular-kachelei v0.0.0 */
!function(a){"use strict";var b=a.module("kachelei",[]);b.constant("kachelConfig",{ratio:1,maxWidth:200,gap:20}),b.directive("kachel",function(){return{restrict:"A",scope:{x:"=kx",y:"=ky"},require:"^kachelei",link:function(a,b,c,d){if(!c.ngRepeat)throw new Error("kachel directive has to be on same element as ng-repeat");b.css({position:"absolute"});var e={element:b,dimensions:{x:a.x,y:a.y}};d.add(e,a.$parent.$index),a.$on("$destroy",function(){d.remove(e)})}}}),b.directive("kachelei",["kDebounce","kRect","kPlacer","kachelConfig","$window",function(b,c,d,e,f){return{restrict:"A",controller:["$scope","$element",function(g,h){function i(a){for(var b=1;e.maxWidth*b+e.gap*(b-1)<a;)b++;return b}function j(a,b){var c=0;return c=(b-e.gap*(a-1))/a}var k=[];h.css({position:"relative"}),this.add=function(a,b){k.splice(b,0,a),m()},this.remove=function(a){k.splice(k.indexOf(a),1),m()};var l=function(){var b=c(h[0]).width,f=i(b),g=j(f,b),l=e.gap,m=[];a.forEach(k,function(a){var b=a.dimensions.x,c=a.dimensions.y;b>f&&(b=f,c=Math.round(c*(f/a.dimensions.x))||1);var h=d.find(m,b,c);d.mark(m,h[0],h[1],b,c,f);var i=b*g+(b-1)*l,j=c*g*e.ratio+(c-1)*l,k=h[0]*g;h[0]>0&&(k+=h[0]*l);var n=h[1]*g*e.ratio;h[1]>0&&(n+=h[1]*l),a.element.css({width:Math.round(i)+"px",height:Math.round(j)+"px",left:Math.round(k)+"px",top:Math.round(n)+"px"})})},m=b(l,0);a.element(f).on("resize",b(l,20))}]}}]),b.factory("kDebounce",function(){return function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}}),b.factory("kPlacer",function(){var a={};return a.find=function(b,c,d){for(var e,f=0,g=0;;){if("undefined"==typeof b[g])return[0,g];if(e=a.findX(b[g],c,f),"undefined"!=typeof e){if(a.fitsY(b,e,g,c,d))return[e,g];f++}else f=0,g++}},a.findX=function(a,b,c){for(var d,e=0,f=a.length;f>e;e++){d=!0;for(var g=0;b>g;g++)d=d&&a[e+g]===!1;if(d){if(!c)return e;c--}}},a.fitsY=function(a,b,c,d,e){if(1===e)return!0;for(var f=!0,g=0;e>g;g++){if("undefined"==typeof a[c+g])return!0;for(var h=0;d>h;h++)f=f&&!a[c+g][b+h];if(!f)return!1}return!0},a.newRow=function(a){for(var b=[],c=0;a>c;c++)b.push(!1);return b},a.mark=function(b,c,d,e,f,g){for(var h=0;f>h;h++){"undefined"==typeof b[d+h]&&b.push(a.newRow(g));for(var i=0;e>i;i++)b[d+h][c+i]=!0}return b},a}),b.factory("kRect",function(){return function(b){var c=a.extend({},b.getBoundingClientRect());return c.height=c.height||c.bottom-c.top,c.width=c.width||c.right-c.left,c}})}(window.angular);